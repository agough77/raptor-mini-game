<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Raptor Chase Game</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; margin: auto; background: url('jungle.png') no-repeat; background-size: 100% 100%; width: 100vw; height: 100vh; }
        #score { color: white; position: absolute; top: 10px; left: 10px; font-size: 20px; }
        #level { color: white; position: absolute; top: 40px; left: 10px; font-size: 20px; }
        #topScores { color: white; position: absolute; top: 70px; left: 10px; font-size: 20px; background-color: black; padding: 10px; border-radius: 5px; }
        #startOver { display: none; position: absolute; bottom: 10px; left: 10px; font-size: 20px; padding: 10px; background-color: white; border: none; cursor: pointer; }
        #finalScore { display: none; position: absolute; bottom: 10px; left: 10px; font-size: 20px; color: white; }
        #gameOverScreen { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; text-align: center; }
    </style>
</head>
<body>
    <div id="score">Score: 0</div>
    <div id="level">Level: 1</div>
    <div id="topScores"></div>
    <div id="gameOverScreen">
        <h1>Game Over</h1>
        <p id="finalScore"></p>
        <button id="startOver">Start Over</button>
    </div>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const humanImg = new Image();
        humanImg.src = 'human.png';
        humanImg.onload = () => console.log('Human image loaded');
        const raptorImg = new Image();
        raptorImg.src = 'raptor.png';
        raptorImg.onload = () => console.log('Raptor image loaded');

        const collisionSound = new Audio('collision.mp3');
        const backgroundMusic = new Audio('background.mp3');
        backgroundMusic.loop = true;

        let human, raptors, score, topScores, gameOver, raptorInterval, gameStarted, level;
        const keys = {};

        function initGame() {
            human = { x: 50, y: 50, size: 40, speed: 5 };
            raptors = [];
            score = 0;
            level = 1;
            topScores = JSON.parse(localStorage.getItem('topScores')) || [];
            gameOver = false;
            gameStarted = false;
            document.getElementById('score').innerText = 'Score: ' + score;
            document.getElementById('level').innerText = 'Level: ' + level;
            document.getElementById('topScores').innerHTML = '';
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('startOver').style.display = 'none';
            clearInterval(raptorInterval);
            backgroundMusic.play();
            for (let key in keys) {
                if (keys.hasOwnProperty(key)) {
                    keys[key] = false;
                }
            }
        }

        function drawHuman() {
            ctx.drawImage(humanImg, human.x, human.y, human.size, human.size);
        }

        function drawRaptors() {
            raptors.forEach(raptor => {
                ctx.drawImage(raptorImg, raptor.x, raptor.y, raptor.size, raptor.size);
            });
        }

        function moveHuman() {
            if (gameStarted) {
                if (keys['ArrowUp'] && human.y > 0) human.y -= human.speed;
                if (keys['ArrowDown'] && human.y < canvas.height - human.size) human.y += human.speed;
                if (keys['ArrowLeft'] && human.x > 0) human.x -= human.speed;
                if (keys['ArrowRight'] && human.x < canvas.width - human.size) human.x += human.speed;
            }
        }

        function moveRaptors() {
            raptors.forEach(raptor => {
                const randomFactor = Math.random() * 2 - 1; // Random value between -1 and 1
                if (raptor.x < human.x) raptor.x += raptor.speed + randomFactor;
                if (raptor.x > human.x) raptor.x -= raptor.speed + randomFactor;
                if (raptor.y < human.y) raptor.y += raptor.speed + randomFactor;
                if (raptor.y > human.y) raptor.y -= raptor.speed + randomFactor;
            });
        }

        function checkCollision() {
            raptors.forEach(raptor => {
                if (human.x < raptor.x + raptor.size &&
                    human.x + human.size > raptor.x &&
                    human.y < raptor.y + raptor.size &&
                    human.y + human.size > raptor.y) {
                    gameOver = true;
                    collisionSound.play();
                    saveScore();
                    document.getElementById('finalScore').innerText = 'Your score: ' + score;
                    displayTopScores();
                    document.getElementById('gameOverScreen').style.display = 'block';
                    document.getElementById('startOver').style.display = 'block';
                    backgroundMusic.pause();
                }
            });
        }

        function updateScore() {
            if (!gameOver && gameStarted) {
                score++;
                document.getElementById('score').innerText = 'Score: ' + score;
                if (score % 100 === 0 && level < 100) {
                    level++;
                    document.getElementById('level').innerText = 'Level: ' + level;
                    human.speed += 1;
                    raptors.forEach(raptor => raptor.speed += 1); // Raptors speed matches human
                    addRaptors(level); // Add more raptors as the level increases
                }
            }
        }

        function saveScore() {
            const name = prompt('Enter your name:');
            topScores.push({ name, score, level });
            topScores.sort((a, b) => b.score - a.score);
            topScores = topScores.slice(0, 10);
            localStorage.setItem('topScores', JSON.stringify(topScores));
        }

        function displayTopScores() {
            const topScoresDiv = document.getElementById('topScores');
            topScoresDiv.innerHTML = '<h2>Top 10 Scores</h2>';
            topScores.forEach((entry, index) => {
                topScoresDiv.innerHTML += `<p>${index + 1}. ${entry.name}: ${entry.score} (Level: ${entry.level})</p>`;
            });
        }

        function gameLoop() {
            if (!gameOver) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawHuman();
                drawRaptors();
                moveHuman();
                moveRaptors();
                checkCollision();
                updateScore();
                requestAnimationFrame(gameLoop);
            }
        }

        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            gameStarted = true;
        });
        window.addEventListener('keyup', (e) => keys[e.key] = false);
        window.addEventListener('mousemove', (e) => {
            if (gameStarted) {
                human.x = e.clientX - human.size / 2;
                human.y = e.clientY - human.size / 2;
            }
        });

        function addRaptor() {
            const size = 40;
            const speed = 2 + level * 0.5;
            const x = Math.random() * (canvas.width - size);
            const y = Math.random() * (canvas.height - size);
            raptors.push({ x, y, size, speed });
        }

        function addRaptors(level) {
            const additionalRaptors = Math.floor(level / 10); // Add more raptors every 10 levels
            for (let i = 0; i < additionalRaptors; i++) {
                addRaptor();
            }
        }

        function startGame() {
            clearInterval(raptorInterval); // Clear any existing intervals
            initGame(); // Reinitialize the game
            raptorInterval = setInterval(addRaptor, 2000);
            gameLoop();
        }

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        document.getElementById('startOver').addEventListener('click', startGame);

        initGame();
        startGame();
    </script>
</body>
</html>
